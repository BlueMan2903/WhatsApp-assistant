services:
  assistant-backend:
    # CHANGED: Now uses the ${TAG} variable. 
    # The ':-latest' part means "if no tag is provided, default to latest" (safety net).
    image: blueman2903/lola-backend:${TAG:-latest}
    
    container_name: assistant-backend
    restart: always
    ports:
      - "5000:5000"
    env_file:
      - ../.env

  ngrok:
    image: ngrok/ngrok:alpine
    container_name: ngrok-sidecar
    restart: always
    command: http --domain=stirring-yearly-anteater.ngrok-free.app assistant-backend:5000
    environment:
      - NGROK_AUTHTOKEN=${NGROK_AUTHTOKEN}
    ports:
      - "4040:4040"
    depends_on:
      - assistant-backend
    env_file:
      - ../.env